<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax RPG: Financial Life Simulator</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        background: '#020617',
                        surface: '#0f172a',
                        primary: '#3b82f6', // Blue 500
                        secondary: '#8b5cf6', // Violet 500
                        accent: '#f59e0b', // Amber 500
                        success: '#10b981',
                        danger: '#ef4444',
                        'gov': '#64748b', // Slate for Govt
                        'biz': '#f97316', // Orange for Biz
                        'rich': '#a855f7', // Purple for Rich
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'glass': 'linear-gradient(180deg, rgba(30, 41, 59, 0.4) 0%, rgba(15, 23, 42, 0.6) 100%)',
                        'gold-gradient': 'linear-gradient(135deg, #fbbf24 0%, #d97706 100%)',
                    }
                }
            }
        }
    </script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #020617;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 40%);
            color: #e2e8f0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }

        .profile-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .profile-card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 10px 30px -10px rgba(59, 130, 246, 0.3);
        }

        .profile-selected {
            border-color: #3b82f6 !important;
            background: rgba(59, 130, 246, 0.1) !important;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        .locked-strategy {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }
    </style>
</head>

<body class="antialiased min-h-screen pb-20">

    <!-- Navbar -->
    <nav class="border-b border-white/5 bg-slate-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600/20 p-2 rounded-lg text-blue-400">
                    <i data-lucide="gamepad-2" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="font-display font-bold text-lg leading-tight">TaxRPG <span
                            class="text-xs font-normal text-slate-400 border border-slate-700 px-1 rounded ml-2">SIMULATOR
                            v2.0</span></h1>
                </div>
            </div>
            <div class="flex items-center gap-4 text-sm">
                <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-slate-800 rounded-full">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    <span class="text-slate-400">System Active</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 md:px-6 py-8 space-y-12">

        <!-- Intro -->
        <header class="text-center max-w-2xl mx-auto">
            <h2 class="font-display font-bold text-4xl text-white mb-4">Choose Your Financial Destiny</h2>
            <p class="text-slate-400 text-lg">Your background dictates your tax rules. Not everyone can play the same
                game.</p>
        </header>

        <!-- Profile Selection -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <!-- Profile 1: Government Employee -->
            <button onclick="selectProfile('gov')" id="profile-gov"
                class="profile-card profile-selected glass-panel rounded-2xl p-6 text-left relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="building-2" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <div
                        class="w-12 h-12 bg-slate-700 rounded-xl flex items-center justify-center mb-4 text-slate-200 shadow-lg">
                        <i data-lucide="scale" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-display font-bold text-xl text-white mb-1">Public Servant</h3>
                    <p class="text-xs font-mono text-slate-400 uppercase tracking-wider mb-4">W-2 • STABLE • HIGH TAX
                    </p>

                    <ul class="space-y-2 text-sm text-slate-300 mb-6">
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            Guaranteed Pension</li>
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            Excellent Benefits</li>
                        <li class="flex items-center gap-2"><i data-lucide="x" class="w-4 h-4 text-red-500"></i> No
                            Business Expensing</li>
                        <li class="flex items-center gap-2"><i data-lucide="x" class="w-4 h-4 text-red-500"></i> Full
                            FICA Taxes</li>
                    </ul>

                    <div class="border-t border-white/10 pt-4 flex justify-between items-center text-xs">
                        <span class="text-slate-500">Starting Salary</span>
                        <span class="font-mono text-white font-bold">$65,000</span>
                    </div>
                </div>
            </button>

            <!-- Profile 2: Business Owner -->
            <button onclick="selectProfile('biz')" id="profile-biz"
                class="profile-card glass-panel rounded-2xl p-6 text-left relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="store" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <div
                        class="w-12 h-12 bg-orange-600 rounded-xl flex items-center justify-center mb-4 text-white shadow-lg">
                        <i data-lucide="briefcase" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-display font-bold text-xl text-white mb-1">Entrepreneur</h3>
                    <p class="text-xs font-mono text-orange-400 uppercase tracking-wider mb-4">1099 • VARIABLE •
                        FLEXIBLE</p>

                    <ul class="space-y-2 text-sm text-slate-300 mb-6">
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            Write-off Expenses</li>
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            20% QBID Deduction</li>
                        <li class="flex items-center gap-2"><i data-lucide="x" class="w-4 h-4 text-red-500"></i> Double
                            FICA (SE Tax)</li>
                        <li class="flex items-center gap-2"><i data-lucide="alert-circle"
                                class="w-4 h-4 text-amber-500"></i> Audit Risk</li>
                    </ul>

                    <div class="border-t border-white/10 pt-4 flex justify-between items-center text-xs">
                        <span class="text-slate-500">Starting Revenue</span>
                        <span class="font-mono text-white font-bold">$120,000</span>
                    </div>
                </div>
            </button>

            <!-- Profile 3: Old Money -->
            <button onclick="selectProfile('rich')" id="profile-rich"
                class="profile-card glass-panel rounded-2xl p-6 text-left relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i data-lucide="landmark" class="w-32 h-32"></i>
                </div>
                <div class="relative z-10">
                    <div
                        class="w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center mb-4 text-white shadow-lg">
                        <i data-lucide="crown" class="w-6 h-6"></i>
                    </div>
                    <h3 class="font-display font-bold text-xl text-white mb-1">Dynastic Wealth</h3>
                    <p class="text-xs font-mono text-purple-400 uppercase tracking-wider mb-4">ASSETS • PASSIVE •
                        OPTIMIZED</p>

                    <ul class="space-y-2 text-sm text-slate-300 mb-6">
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            Capital Gains Rates</li>
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            Borrow Against Assets</li>
                        <li class="flex items-center gap-2"><i data-lucide="check" class="w-4 h-4 text-emerald-500"></i>
                            NO FICA / Payroll Tax</li>
                        <li class="flex items-center gap-2"><i data-lucide="x" class="w-4 h-4 text-slate-500"></i> Low
                            "Earned" Income</li>
                    </ul>

                    <div class="border-t border-white/10 pt-4 flex justify-between items-center text-xs">
                        <span class="text-slate-500">Starting Assets</span>
                        <span class="font-mono text-white font-bold">$10,000,000</span>
                    </div>
                </div>
            </button>
        </section>

        <!-- Dashboard -->
        <div id="game-dashboard" class="grid lg:grid-cols-3 gap-8 opacity-100 transition-opacity duration-500">

            <!-- Left: Controls & Stats -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Income Control -->
                <div class="glass-panel rounded-2xl p-6">
                    <label class="block text-sm font-bold text-slate-400 mb-2">Adjust Scale</label>
                    <div class="flex items-baseline gap-1 mb-4">
                        <span class="text-3xl font-display font-bold text-white" id="income-display">$65,000</span>
                    </div>
                    <input type="range" id="income-slider"
                        class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"
                        min="0" max="200" value="20">
                    <div class="flex justify-between text-xs text-slate-500 mt-2">
                        <span>Baseline</span>
                        <span>Max Potential</span>
                    </div>
                </div>

                <!-- Tax Bill Breakdown -->
                <div class="glass-panel rounded-2xl p-6 relative overflow-hidden">
                    <h4 class="font-display font-bold text-white mb-4 flex items-center gap-2">
                        <i data-lucide="receipt" class="w-4 h-4 text-slate-400"></i> Tax Bill Impact
                    </h4>

                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-slate-400">Federal Tax</span>
                            <span id="tax-fed" class="font-mono text-red-400">-$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">FICA / SE Tax</span>
                            <span id="tax-fica" class="font-mono text-red-400">-$0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">State Tax</span>
                            <span id="tax-state" class="font-mono text-red-400">-$0</span>
                        </div>
                        <div class="h-px bg-white/10 my-2"></div>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-white">Effective Rate</span>
                            <div class="text-right">
                                <span id="tax-rate" class="block font-mono text-xl font-bold text-white">0%</span>
                                <span id="tax-saved-msg" class="text-xs text-emerald-400 hidden">Saved $12,000!</span>
                            </div>
                        </div>

                        <!-- Visual Bar -->
                        <div class="w-full h-4 bg-slate-800 rounded-full mt-4 overflow-hidden flex">
                            <div id="bar-keep" class="h-full bg-emerald-500" style="width: 70%"></div>
                            <div id="bar-tax" class="h-full bg-red-500" style="width: 30%"></div>
                        </div>
                        <div class="flex justify-between text-[10px] text-slate-500 uppercase tracking-wider font-bold">
                            <span>Keep</span>
                            <span>Tax</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Strategy Deck -->
            <div class="lg:col-span-2 space-y-6">
                <div class="glass-panel rounded-2xl p-6">
                    <h3 class="font-display font-bold text-xl text-white mb-6 flex items-center justify-between">
                        <span>Available Strategies</span>
                        <span class="text-xs font-normal text-slate-500 bg-slate-800 px-2 py-1 rounded">SELECT TO
                            ACTIVATE</span>
                    </h3>

                    <div class="grid md:grid-cols-2 gap-4">

                        <!-- Strategy: Standard Deduction -->
                        <button onclick="toggleStrategy('standard')" id="strat-standard"
                            class="group text-left p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:bg-slate-700/50 transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-white">Standard Deduction</h4>
                                <i data-lucide="shield" class="w-5 h-5 text-slate-400"></i>
                            </div>
                            <p class="text-sm text-slate-400 mb-2">Reduce taxable income by a fixed amount ($14,600).
                                Simple and safe.</p>
                            <span
                                class="inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-500/20 text-emerald-400 uppercase">Universal</span>
                        </button>

                        <!-- Strategy: Business Expensing -->
                        <button onclick="toggleStrategy('expense')" id="strat-expense"
                            class="group text-left p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:bg-slate-700/50 transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-white">Business "Expensing"</h4>
                                <i data-lucide="coffee" class="w-5 h-5 text-orange-400"></i>
                            </div>
                            <p class="text-sm text-slate-400 mb-2">Deduct cars, dinners, and travel as "necessary"
                                costs.</p>
                            <span
                                class="strat-tag inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-orange-500/20 text-orange-400 uppercase">Business
                                Only</span>
                        </button>

                        <!-- Strategy: Buy Borrow Die -->
                        <button onclick="toggleStrategy('bbd')" id="strat-bbd"
                            class="group text-left p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:bg-slate-700/50 transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-white">Buy, Borrow, Die</h4>
                                <i data-lucide="infinity" class="w-5 h-5 text-purple-400"></i>
                            </div>
                            <p class="text-sm text-slate-400 mb-2">Borrow against assets to pay 0% tax. Loans aren't
                                income.</p>
                            <div class="flex gap-2">
                                <span
                                    class="strat-tag inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-purple-500/20 text-purple-400 uppercase">Assets
                                    > $1M</span>
                            </div>
                        </button>

                        <!-- Strategy: QBI Deduction -->
                        <button onclick="toggleStrategy('qbi')" id="strat-qbi"
                            class="group text-left p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:bg-slate-700/50 transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-white">Section 199A (QBI)</h4>
                                <i data-lucide="scissors" class="w-5 h-5 text-blue-400"></i>
                            </div>
                            <p class="text-sm text-slate-400 mb-2">Slice 20% off your taxable income automatically.</p>
                            <span
                                class="strat-tag inline-block px-2 py-0.5 rounded text-[10px] font-bold bg-orange-500/20 text-orange-400 uppercase">Business
                                Only</span>
                        </button>

                    </div>
                </div>

                <!-- Projection View -->
                <div class="glass-panel rounded-2xl p-6">
                    <h4 class="font-display font-bold text-white mb-4">Life Outcome (30 Years)</h4>
                    <canvas id="projection-chart" height="100"></canvas>
                </div>
            </div>
        </div>

    </main>

    <!-- Scripts -->
    <script>
        // --- Data Definitions ---
        const PROFILES = {
            gov: {
                name: 'Public Servant',
                icon: 'building-2',
                base: 65000,
                max: 180000,
                type: 'w2',
                assets: 50000,
                color: '#64748b',
                allowed: ['standard'], // Govt worker options often limited to basics + pension (implicit)
                desc: 'Government work is stable but rigid. You cannot deduct expenses or use asset-based loops.'
            },
            biz: {
                name: 'Entrepreneur',
                icon: 'store',
                base: 120000,
                max: 2000000, // High ceiling
                type: '1099',
                assets: 200000,
                color: '#f97316',
                allowed: ['standard', 'expense', 'qbi'],
                desc: 'You have high control over taxation but face Self-Employment taxes.'
            },
            rich: {
                name: 'Dynastic Wealth',
                icon: 'landmark',
                base: 0, // No salary
                max: 0,
                type: 'capital',
                assets: 10000000, // Starts huge
                color: '#a855f7',
                allowed: ['standard', 'bbd'],
                desc: 'Income is optional. You live off loans and capital gains.'
            }
        };

        const STRATEGIES = {
            standard: { name: 'Standard Deduction', val: 14600, type: 'deduction' },
            expense: { name: 'Expensing', val: 0.15, type: 'percent_deduction' }, // Expense 15% of revenue
            qbi: { name: 'QBI', val: 0.20, type: 'percent_deduction_post' }, // 20% of net
            bbd: { name: 'Buy Borrow Die', val: 0.0, type: 'override' } // 0 tax
        };

        // --- State ---
        let currentProfileId = 'gov';
        let incomeScale = 20; // % of max
        let activeStrategies = new Set(['standard']);
        let chartInstance = null;

        // --- Core Logic ---
        function calculateTaxes() {
            const profile = PROFILES[currentProfileId];
            let rawIncome = 0;
            let currentAssets = 0;

            // 1. Determine base numbers based on simulator slider
            if (profile.type === 'capital') {
                // For rich, slider adjusts "Living Expenses" drawn from assets
                // But for sim simplicity, let's say slider adjusts total asset base scale
                const scale = document.getElementById('income-slider').value / 20; // 1.0 = baseline
                currentAssets = profile.assets * scale;
                rawIncome = currentAssets * 0.05; // 5% yield/withdrawal
            } else {
                // For w2/biz, slider is income
                const scale = document.getElementById('income-slider').value / 20;
                rawIncome = profile.base * scale;
            }

            // 2. Strategy Effects
            let taxableIncome = rawIncome;
            let deduction = 0;
            let seTax = 0;
            let effectiveRate = 0;
            let fedTax = 0;
            let stateTax = 0;

            // Apply 'Expense' (Business only)
            if (activeStrategies.has('expense') && profile.type === '1099') {
                deduction += rawIncome * STRATEGIES.expense.val;
            }

            // Apply Standard Deduction
            if (activeStrategies.has('standard')) {
                // If Itemizing (business expensing includes standard) usually logic is complex
                // Simplified: You get standard unless expensing is huge. simplified: stack for game fun
                deduction += STRATEGIES.standard.val;
            }

            let netIncome = Math.max(0, rawIncome - deduction);

            // Apply QBI
            if (activeStrategies.has('qbi') && profile.type === '1099') {
                netIncome = netIncome * (1 - STRATEGIES.qbi.val);
            }

            // 3. Tax Calculation
            if (profile.type === 'w2') {
                // FICA
                const ssCap = 168600;
                let fica = Math.min(rawIncome, ssCap) * 0.062 + rawIncome * 0.0145;
                seTax = fica; // Just calling it seTax var for simplicity

                // Fed
                fedTax = calculateFedBracket(netIncome);
                stateTax = netIncome * 0.05;

            } else if (profile.type === '1099') {
                // SE Tax (Employer + Employee side) approx 15.3%
                const ssCap = 168600;
                let se = Math.min(netIncome, ssCap) * 0.124 + netIncome * 0.029;
                seTax = se;

                // Fed (deduct 1/2 SE tax)
                const adjNet = netIncome - (se * 0.5);
                fedTax = calculateFedBracket(adjNet);
                stateTax = adjNet * 0.05;

            } else if (profile.type === 'capital') {
                // Buy Borrow Die?
                if (activeStrategies.has('bbd')) {
                    fedTax = 0;
                    seTax = 0; // Loans aren't income
                    stateTax = 0;
                } else {
                    // Normal LTCG
                    fedTax = calculateLTCG(netIncome); // netIncome here is just the 5% withdrawal
                    seTax = 0; // No FICA on gains
                    stateTax = netIncome * 0.05;
                }
            }

            const totalTax = fedTax + seTax + stateTax;
            const keep = rawIncome - totalTax;
            effectiveRate = (totalTax / rawIncome) * 100;
            if (isNaN(effectiveRate)) effectiveRate = 0;

            return {
                raw: rawIncome,
                assets: currentAssets || 0,
                fed: fedTax,
                fica: seTax,
                state: stateTax,
                total: totalTax,
                keep: keep,
                rate: effectiveRate
            };
        }

        function calculateFedBracket(income) {
            // Simplified 2024 single brackets
            if (income < 11600) return income * 0.10;
            if (income < 47150) return 1160 + (income - 11600) * 0.12;
            if (income < 100525) return 5426 + (income - 47150) * 0.22;
            if (income < 191950) return 17168 + (income - 100525) * 0.24;
            if (income < 243725) return 39110 + (income - 191950) * 0.32;
            return 55678 + (income - 243725) * 0.35; // Cap at 35 for simplicity
        }

        function calculateLTCG(income) {
            if (income < 47000) return 0;
            if (income < 518000) return (income - 47000) * 0.15;
            return 70650 + (income - 518000) * 0.20;
        }

        // --- UI Updates ---
        const formatMoney = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n);

        function updateUI() {
            const result = calculateTaxes();

            // 1. Text Update
            document.getElementById('income-display').textContent = formatMoney(result.raw);
            document.getElementById('tax-fed').textContent = '-' + formatMoney(result.fed);
            document.getElementById('tax-fica').textContent = '-' + formatMoney(result.fica);
            document.getElementById('tax-state').textContent = '-' + formatMoney(result.state);

            document.getElementById('tax-rate').textContent = result.rate.toFixed(1) + '%';

            // 2. Bar visuals
            const totalScale = result.raw > 0 ? result.raw : 1;
            const taxPct = (result.total / totalScale) * 100;
            const keepPct = 100 - taxPct;

            document.getElementById('bar-keep').style.width = keepPct + '%';
            document.getElementById('bar-tax').style.width = taxPct + '%';

            if (result.rate < 15 && result.raw > 100000) {
                document.getElementById('tax-saved-msg').classList.remove('hidden');
                document.getElementById('tax-saved-msg').textContent = "Tax Efficiency High!";
            } else {
                document.getElementById('tax-saved-msg').classList.add('hidden');
            }

            // 3. Lock/Unlock Strategies based on Profile
            const profile = PROFILES[currentProfileId];
            ['expense', 'qbi', 'bbd'].forEach(strat => {
                const el = document.getElementById('strat-' + strat);
                if (profile.allowed.includes(strat)) {
                    el.classList.remove('locked-strategy');
                    // visual check if active
                    if (activeStrategies.has(strat)) {
                        el.classList.add('border-blue-500', 'bg-blue-500/10');
                        el.classList.remove('border-slate-700');
                    } else {
                        el.classList.remove('border-blue-500', 'bg-blue-500/10');
                        el.classList.add('border-slate-700');
                    }
                } else {
                    el.classList.add('locked-strategy');
                    el.classList.remove('border-blue-500', 'bg-blue-500/10');
                    // Force disable if somehow active
                    if (activeStrategies.has(strat)) activeStrategies.delete(strat);
                }
            });

            updateChart(result.keep);
        }

        function selectProfile(id) {
            currentProfileId = id;

            // Visual selection
            document.querySelectorAll('.profile-card').forEach(el => el.classList.remove('profile-selected'));
            document.getElementById('profile-' + id).classList.add('profile-selected');

            // Reset strategies
            activeStrategies = new Set(['standard']);

            updateUI();
        }

        function toggleStrategy(id) {
            const profile = PROFILES[currentProfileId];
            if (!profile.allowed.includes(id)) return; // Locked

            if (activeStrategies.has(id)) {
                activeStrategies.delete(id);
            } else {
                activeStrategies.add(id);
            }
            updateUI();
        }

        // --- Chart ---
        function initChart() {
            const ctx = document.getElementById('projection-chart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 30 }, (_, i) => i + 1),
                    datasets: [{
                        label: 'Net Wealth',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#64748b' }
                        }
                    }
                }
            });
        }

        function updateChart(annualNet) {
            if (!chartInstance) return;
            const data = [];
            let wealth = 0;

            // Simple compound
            const rate = PROFILES[currentProfileId].type === 'capital' ? 0.08 : 0.06;

            for (let i = 0; i < 30; i++) {
                // For 'Rich', annualNet is 'spending money', the wealth grows separately
                // For others, annualNet is added to wealth
                if (PROFILES[currentProfileId].type === 'capital') {
                    // Wealth grows by market - spending
                    // We need to estimate base wealth
                    let base = PROFILES[currentProfileId].assets * (document.getElementById('income-slider').value / 20);
                    // This is complex for a simple chart, simplified:
                    wealth = base * Math.pow(1.07, i); // Just show the asset growth curve
                } else {
                    wealth = (wealth + annualNet) * (1 + rate);
                }
                data.push(wealth);
            }

            chartInstance.data.datasets[0].data = data;
            chartInstance.data.datasets[0].borderColor = PROFILES[currentProfileId].color;
            chartInstance.data.datasets[0].backgroundColor = PROFILES[currentProfileId].color + '20'; // hex + alpha
            chartInstance.update();
        }

        // --- Init ---
        lucide.createIcons();
        initChart();

        document.getElementById('income-slider').addEventListener('input', updateUI);

        // Start
        updateUI();

    </script>
</body>

</html>